# TinyRISCV处理器流水线修改记录

## 分析发现

在分析过程中，我们发现TinyRISCV原本的设计已经包含了五级流水线的结构，但是在我们提供的代码中，相应的文件（ex_mem.v、mem.v、mem_wb.v、wb.v）可能缺失。

## 主要修改内容

1. 创建/补充了五级流水线所需的文件：
   - `ex_mem.v`: EX/MEM流水线寄存器，连接执行和访存阶段
   - `mem.v`: 访存模块，实现访存阶段的功能
   - `mem_wb.v`: MEM/WB流水线寄存器，连接访存和写回阶段
   - `wb.v`: 写回模块，实现写回阶段的功能

2. 更新了暂停控制逻辑：
   - 在`defines.v`中添加了`Hold_Wb`（3'b110）定义
   - 在`ctrl.v`中更新了暂停控制逻辑，使其支持五级流水线

3. 更新了顶层连接：
   - 修正了`tinyriscv.v`中的总线连接逻辑
   - 维持了数据前向通路的功能

## 五级流水线结构

### IF阶段（取指令）
- 从指令存储器中取出指令
- 计算下一条指令的地址

### ID阶段（指令解码）
- 解码指令，确定操作类型
- 从寄存器堆中读取源操作数
- 处理数据前向通路，解决数据冒险

### EX阶段（执行）
- 进行算术逻辑运算
- 计算跳转/分支地址
- 计算访存地址

### MEM阶段（访存）
- 完成访存操作（加载/存储）
- 处理内存访问相关的指令

### WB阶段（写回）
- 将结果写回寄存器堆

## 性能提升

五级流水线的实现提高了处理器的吞吐量，在理想情况下可以达到每个时钟周期执行一条指令的性能。在有数据冒险的情况下，通过数据前向技术减少了流水线暂停的需求。 